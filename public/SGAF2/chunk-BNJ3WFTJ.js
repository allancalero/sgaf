import{Cb as b,Db as n,Eb as x,Fb as u,Fc as P,Ib as C,Jb as y,Jc as k,Kb as I,Na as a,Oc as D,Pb as w,Pc as O,Qc as z,Rb as N,Tc as F,Va as S,Vc as $,Wc as R,Z as g,_,_a as E,bb as m,c as V,jb as d,kb as i,kc as T,lb as t,lc as A,mc as M,pb as h,pc as B,rb as f,sb as c}from"./chunk-KK5YFQP7.js";var s=V($());function L(o,r){o&1&&(i(0,"div",19),n(1,"Cargando solicitudes..."),t())}function W(o,r){o&1&&(i(0,"div",19),n(1,"No hay solicitudes encontradas."),t())}function q(o,r){if(o&1&&(i(0,"div")(1,"p",29),n(2),t(),i(3,"p",30),n(4),t()()),o&2){let e=c().$implicit;a(2),x(e.activo.codigo_inventario),a(2),x(e.activo.nombre_activo)}}function G(o,r){if(o&1&&(i(0,"p",33),n(1),t()),o&2){let e=c(2).$implicit;a(),x(e.nota_admin)}}function H(o,r){if(o&1&&(i(0,"div",31),n(1," (Activo Eliminado / No Encontrado) "),m(2,G,2,1,"p",32),t()),o&2){let e=c().$implicit;a(2),d("ngIf",e.nota_admin)}}function Z(o,r){if(o&1){let e=h();i(0,"div",34)(1,"button",35),f("click",function(){g(e);let v=c().$implicit,p=c();return _(p.aprobar(v.id))}),n(2," Aprobar Baja "),t(),i(3,"button",36),f("click",function(){g(e);let v=c().$implicit,p=c();return _(p.rechazar(v.id))}),n(4," Rechazar "),t()()}}function J(o,r){if(o&1&&(i(0,"span",39),n(1),t()),o&2){let e=c(2).$implicit;d("title",e.nota_admin),a(),u("Nota: ",e.nota_admin)}}function K(o,r){if(o&1&&(i(0,"div",37)(1,"span"),n(2),t(),m(3,J,2,2,"span",38),t()),o&2){let e=c().$implicit;a(2),u("Procesado por: ",(e.procesador==null?null:e.procesador.email)||"Sistema"),a(),d("ngIf",e.nota_admin)}}function Q(o,r){if(o&1&&(i(0,"div",20)(1,"div",21),n(2),t(),i(3,"div",13),m(4,q,5,2,"div",22)(5,H,3,1,"div",23),t(),i(6,"div",14)(7,"p",24),n(8),t(),i(9,"p",25),n(10),w(11,"date"),t()(),i(12,"div",13)(13,"p",26),n(14),t()(),i(15,"div",12)(16,"span"),n(17),t()(),m(18,Z,5,0,"div",27)(19,K,4,2,"div",28),t()),o&2){let e=r.$implicit;a(2),u("#",e.id),a(2),d("ngIf",e.activo),a(),d("ngIf",!e.activo),a(3),x((e.solicitante==null?null:e.solicitante.email)||"N/A"),a(2),x(N(11,11,e.created_at,"short")),a(4),u('"',e.motivo,'"'),a(2),b("px-2 py-1 rounded text-[10px] font-black uppercase "+(e.estado==="PENDIENTE"?"bg-blue-500/10 text-blue-500":e.estado==="APROBADO"?"bg-red-500/10 text-red-500":"bg-orange-500/10 text-orange-500")),a(),u(" ",e.estado," "),a(),d("ngIf",e.estado==="PENDIENTE"),a(),d("ngIf",e.estado!=="PENDIENTE")}}var j=class o{constructor(r){this.assetService=r}solicitudes=[];loading=!0;filterEstado="PENDIENTE";ngOnInit(){this.loadSolicitudes()}loadSolicitudes(){this.loading=!0,this.assetService.getSolicitudes(this.filterEstado).subscribe({next:r=>{this.solicitudes=r.data,this.loading=!1},error:r=>{console.error(r),this.loading=!1}})}aprobar(r){s.default.fire({title:"\xBFAprobar Baja?",text:"El activo ser\xE1 eliminado permanentemente. Esta acci\xF3n no se puede deshacer.",icon:"warning",input:"textarea",inputPlaceholder:"Nota de aprobaci\xF3n (opcional)",showCancelButton:!0,confirmButtonText:"S\xED, Aprobar y Eliminar",confirmButtonColor:"#ef4444",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&this.assetService.approveSolicitud(r,e.value).subscribe({next:()=>{s.default.fire("Aprobado","El activo ha sido eliminado.","success"),this.loadSolicitudes()},error:l=>s.default.fire("Error",l.error.message||"Error","error")})})}rechazar(r){s.default.fire({title:"\xBFRechazar Solicitud?",text:"La solicitud ser\xE1 marcada como rechazada.",input:"textarea",inputPlaceholder:"Motivo del rechazo (Requerido)",icon:"info",showCancelButton:!0,confirmButtonText:"Rechazar",confirmButtonColor:"#f59e0b",preConfirm:e=>(e||s.default.showValidationMessage("Debes ingresar un motivo"),e)}).then(e=>{e.isConfirmed&&this.assetService.rejectSolicitud(r,e.value).subscribe({next:()=>{s.default.fire("Rechazado","La solicitud ha sido rechazada.","info"),this.loadSolicitudes()},error:l=>s.default.fire("Error",l.error.message||"Error","error")})})}static \u0275fac=function(e){return new(e||o)(S(R))};static \u0275cmp=E({type:o,selectors:[["app-solicitudes"]],decls:35,vars:4,consts:[[1,"mb-8"],[1,"text-3xl","font-black","text-primary","tracking-tight"],[1,"text-secondary","mt-1","tracking-tight"],[1,"card","p-4","mb-6","flex","gap-4","items-center"],[1,"text-xs","font-bold","uppercase","text-muted"],[1,"input-field","w-48","text-sm",3,"ngModelChange","change","ngModel"],["value","PENDIENTE"],["value","APROBADO"],["value","RECHAZADO"],["value",""],[1,"card","overflow-hidden"],[1,"bg-gray-500/5","text-muted","text-[10px]","font-black","uppercase","tracking-widest","border-b","border-white/5","hidden","md:grid","grid-cols-12","gap-4","px-6","py-4"],[1,"col-span-1"],[1,"col-span-3"],[1,"col-span-2"],[1,"col-span-2","text-right"],[1,"divide-y","divide-white/5"],["class","p-8 text-center text-muted",4,"ngIf"],["class","grid grid-cols-1 md:grid-cols-12 gap-4 p-6 items-center hover:bg-white/5 transition-colors",4,"ngFor","ngForOf"],[1,"p-8","text-center","text-muted"],[1,"grid","grid-cols-1","md:grid-cols-12","gap-4","p-6","items-center","hover:bg-white/5","transition-colors"],[1,"col-span-1","font-mono","text-xs","text-muted"],[4,"ngIf"],["class","text-xs text-red-500 italic",4,"ngIf"],[1,"text-xs","font-bold","text-gray-300"],[1,"text-[10px]","text-muted"],[1,"text-sm","text-gray-400","italic"],["class","col-span-2 flex justify-end gap-2",4,"ngIf"],["class","col-span-2 flex flex-col items-end text-[10px] text-muted",4,"ngIf"],[1,"text-sm","font-black","text-primary"],[1,"text-xs","text-muted"],[1,"text-xs","text-red-500","italic"],["class","text-[9px] text-muted",4,"ngIf"],[1,"text-[9px]","text-muted"],[1,"col-span-2","flex","justify-end","gap-2"],[1,"btn-primary","px-3","py-1","text-xs","bg-red-600","hover:bg-red-700","border-none",3,"click"],[1,"btn-secondary","px-3","py-1","text-xs",3,"click"],[1,"col-span-2","flex","flex-col","items-end","text-[10px]","text-muted"],["class","italic max-w-[150px] truncate",3,"title",4,"ngIf"],[1,"italic","max-w-[150px]","truncate",3,"title"]],template:function(e,l){e&1&&(i(0,"div",0)(1,"h2",1),n(2,"Solicitudes de Baja"),t(),i(3,"p",2),n(4,"Gesti\xF3n de aprobaciones para eliminaci\xF3n de activos."),t()(),i(5,"div",3)(6,"span",4),n(7,"Filtrar por estado:"),t(),i(8,"select",5),I("ngModelChange",function(p){return y(l.filterEstado,p)||(l.filterEstado=p),p}),f("change",function(){return l.loadSolicitudes()}),i(9,"option",6),n(10,"Pendientes"),t(),i(11,"option",7),n(12,"Aprobados"),t(),i(13,"option",8),n(14,"Rechazados"),t(),i(15,"option",9),n(16,"Todos"),t()()(),i(17,"div",10)(18,"div",11)(19,"div",12),n(20,"#"),t(),i(21,"div",13),n(22,"Activo"),t(),i(23,"div",14),n(24,"Solicitante"),t(),i(25,"div",13),n(26,"Motivo"),t(),i(27,"div",12),n(28,"Estado"),t(),i(29,"div",15),n(30,"Acciones"),t()(),i(31,"div",16),m(32,L,2,0,"div",17)(33,W,2,0,"div",17)(34,Q,20,14,"div",18),t()()),e&2&&(a(8),C("ngModel",l.filterEstado),a(24),d("ngIf",l.loading),a(),d("ngIf",!l.loading&&l.solicitudes.length===0),a(),d("ngForOf",l.solicitudes))},dependencies:[B,T,A,F,O,z,D,P,k,M],encapsulation:2})};export{j as SolicitudesComponent};
