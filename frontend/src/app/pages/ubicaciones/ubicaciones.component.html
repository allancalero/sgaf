<div class="p-6 lg:p-12 animate-fade-in">
    <div class="mb-12 text-center lg:text-left">
        <h2 class="text-5xl font-orbitron font-black text-white tracking-tighter uppercase leading-none">Estructura
            <span class="text-red-600">Organizativa</span>
        </h2>
        <p class="text-red-500/80 mt-4 text-sm font-black uppercase tracking-[0.3em]">Gestión jerárquica de activos:
            Definición de áreas y despliegue físico.</p>
    </div>

    <!-- Radiant Search Bar -->
    <div class="mb-10">
        <div class="relative group">
            <input type="text" [(ngModel)]="searchText"
                class="w-full bg-black/40 backdrop-blur-3xl border border-white/10 rounded-3xl py-6 pl-16 pr-6 text-white font-bold placeholder-white/20 focus:outline-none focus:ring-2 focus:ring-red-600/30 transition-all text-xl shadow-2xl text-center"
                placeholder="BUSCAR EN {{ activeTab === 'areas' ? 'DEPARTAMENTOS' : 'UBICACIONES' }}...">
            <div class="absolute inset-y-0 left-0 pl-7 flex items-center pointer-events-none">
                <i class="fas fa-search text-red-500 text-xl group-focus-within:scale-110 transition-transform"></i>
            </div>
            <div *ngIf="searchText" class="absolute inset-y-0 right-0 pr-7 flex items-center">
                <button (click)="searchText = ''" class="text-white/20 hover:text-white transition-colors">
                    <i class="fas fa-times-circle text-lg"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs Radiant -->
    <div class="flex gap-4 mb-10 overflow-x-auto pb-4 custom-scrollbar">
        <button (click)="activeTab = 'areas'" [class]="activeTab === 'areas' 
            ? 'bg-red-600 text-white shadow-[0_0_20px_rgba(220,38,38,0.3)] ring-2 ring-red-600/50' 
            : 'bg-white/5 text-white/40 hover:bg-white/10'"
            class="px-8 py-4 rounded-2xl font-black text-xs uppercase tracking-widest transition-all shrink-0 flex items-center gap-3">
            <i class="fas fa-building" [class.text-white]="activeTab === 'areas'"></i>
            DEPARTAMENTOS ({{ areas.length }})
        </button>
        <button (click)="activeTab = 'ubicaciones'" [class]="activeTab === 'ubicaciones' 
            ? 'bg-red-600 text-white shadow-[0_0_20px_rgba(220,38,38,0.3)] ring-2 ring-red-600/50' 
            : 'bg-white/5 text-white/40 hover:bg-white/10'"
            class="px-8 py-4 rounded-2xl font-black text-xs uppercase tracking-widest transition-all shrink-0 flex items-center gap-3">
            <i class="fas fa-map-marker-alt" [class.text-white]="activeTab === 'ubicaciones'"></i>
            UBICACIONES ({{ ubicaciones.length }})
        </button>
    </div>

    <!-- Integrated Data Entry Form Radiant -->
    <div *ngIf="showForm" class="mb-12 animate-in zoom-in-95 duration-300">
        <div
            class="bg-black/40 backdrop-blur-3xl border border-white/10 rounded-[2.5rem] overflow-hidden shadow-2xl relative">
            <div
                class="absolute top-0 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-red-600 to-transparent">
            </div>

            <div class="flex border-b border-white/5 bg-white/[0.02] justify-between items-center px-10 py-6">
                <h3 class="text-[10px] font-black uppercase tracking-[0.4em] text-red-500 flex items-center gap-3">
                    <span class="w-2 h-2 rounded-full bg-red-600 animate-pulse"></span>
                    {{ editingAreaId || editingUbicacionId ? 'MODIFICAR' : 'REGISTRAR' }} COMPONENTE
                </h3>
                <button (click)="closeForm()"
                    class="w-10 h-10 flex items-center justify-center text-white/20 hover:text-white bg-white/5 hover:bg-white/10 rounded-xl transition-all">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="px-8 py-8">
                <!-- AREA FORM -->
                <form *ngIf="activeFormTab === 'area'" (ngSubmit)="saveArea()" class="space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-3">
                            <label
                                class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-2">Denominación
                                del Área</label>
                            <input type="text" [(ngModel)]="areaForm.nombre" name="nombre"
                                class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white font-bold focus:outline-none focus:ring-2 focus:ring-red-600/30 transition-all placeholder-white/10"
                                placeholder="EJ. RECURSOS HUMANOS">
                        </div>
                        <div class="space-y-3">
                            <label
                                class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-2">Asignación
                                Geográfica</label>
                            <div class="relative">
                                <select [(ngModel)]="areaForm.ubicacion_id" name="ubi_id"
                                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white font-black uppercase text-xs appearance-none focus:outline-none focus:ring-2 focus:ring-red-600/30 transition-all">
                                    <option [ngValue]="null" class="bg-[#0a0f1d]">SIN ASIGNACIÓN ESPECÍFICA</option>
                                    <option *ngFor="let u of ubicaciones; let i = index" [value]="u.id"
                                        class="bg-[#0a0f1d]">
                                        {{ (i + 1).toString().padStart(2, '0') }} {{ u.nombre }}
                                    </option>
                                </select>
                                <i
                                    class="fas fa-chevron-down absolute right-6 top-1/2 -translate-y-1/2 text-red-500 pointer-events-none"></i>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="space-y-3">
                            <label class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-2">Estatus
                                Sistema</label>
                            <div class="relative">
                                <select [(ngModel)]="areaForm.estado" name="estado"
                                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white font-black uppercase text-xs appearance-none focus:outline-none focus:ring-2 focus:ring-red-600/30 transition-all">
                                    <option value="ACTIVO" class="bg-[#0a0f1d]">ACTIVO / OPERATIVO</option>
                                    <option value="INACTIVO" class="bg-[#0a0f1d]">INACTIVO / BLOQUEADO</option>
                                </select>
                                <i
                                    class="fas fa-shield-alt absolute right-6 top-1/2 -translate-y-1/2 text-red-500 pointer-events-none"></i>
                            </div>
                        </div>
                        <div class="flex justify-end gap-4 mt-6">
                            <button type="submit"
                                class="btn-primary w-full md:w-auto px-10 h-14 !shadow-red-600/30 font-black tracking-widest text-xs">
                                {{ editingAreaId ? 'ACTUALIZAR ÁREA' : 'CONFIRMAR ÁREA' }}
                            </button>
                        </div>
                    </div>
                </form>

                <!-- UBICACION FORM -->
                <form *ngIf="activeFormTab === 'ubicacion'" (ngSubmit)="saveUbicacion()" class="space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-3">
                            <label class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-2">Nombre
                                del
                                Inmueble</label>
                            <input type="text" [(ngModel)]="ubicacionForm.nombre" name="nombre_ubi"
                                class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white font-bold focus:outline-none focus:ring-2 focus:ring-red-600/30 transition-all placeholder-white/10"
                                placeholder="EJ. EDIFICIO MUNICIPAL CENTRAL">
                        </div>
                        <div class="space-y-3">
                            <label
                                class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-2">Referencia
                                de Acceso</label>
                            <input type="text" [(ngModel)]="ubicacionForm.direccion" name="dir"
                                class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white font-bold focus:outline-none focus:ring-2 focus:ring-red-600/30 transition-all placeholder-white/10"
                                placeholder="EJ. ALA NORTE, SEGUNDO NIVEL">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="space-y-3">
                            <label
                                class="text-[10px] font-black text-white/40 uppercase tracking-[0.2em] ml-2">Disponibilidad</label>
                            <div class="relative">
                                <select [(ngModel)]="ubicacionForm.estado" name="estado_ubi"
                                    class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-4 text-white font-black uppercase text-xs appearance-none focus:outline-none focus:ring-2 focus:ring-red-600/30 transition-all">
                                    <option value="ACTIVO" class="bg-[#0a0f1d]">DISPONIBLE</option>
                                    <option value="INACTIVO" class="bg-[#0a0f1d]">MANTENIMIENTO / FUERA DE USO</option>
                                </select>
                                <i
                                    class="fas fa-check-double absolute right-6 top-1/2 -translate-y-1/2 text-red-500 pointer-events-none"></i>
                            </div>
                        </div>
                        <div class="flex justify-end gap-4 mt-6">
                            <button type="submit"
                                class="btn-primary w-full md:w-auto px-10 h-14 !shadow-red-600/30 font-black tracking-widest text-xs">
                                {{ editingUbicacionId ? 'ACTUALIZAR SITIO' : 'REGISTRAR SITIO' }}
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- TAB CONTENT -->

    <!-- Areas Section -->
    <div *ngIf="activeTab === 'areas'" class="animate-fade-in">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
            <h3 class="text-[10px] font-black text-red-500 uppercase tracking-[0.4em] flex items-center gap-3">
                <span class="w-8 h-[1px] bg-red-600"></span>
                Catálogo de Departamentos
            </h3>
            <button (click)="openForm('area')"
                class="btn-primary h-12 px-8 !shadow-red-600/30 text-[10px] font-black tracking-widest">
                <i class="fas fa-plus mr-2"></i> NUEVO DEPARTAMENTO
            </button>
        </div>

        <div class="bg-black/40 backdrop-blur-3xl border border-white/10 rounded-[2.5rem] overflow-hidden shadow-2xl">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr
                            class="bg-black/40 text-white/40 text-[9px] font-black uppercase tracking-[0.3em] border-b border-white/5">
                            <th class="px-10 py-6 w-20">Índice</th>
                            <th class="px-10 py-6">Identificador / Nombre</th>
                            <th class="px-10 py-6 text-center">Localización</th>
                            <th class="px-10 py-6 text-center">Estatus</th>
                            <th class="px-10 py-6 text-right">Control</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-white/5 font-medium">
                        <tr *ngFor="let area of filteredAreas; let i = index"
                            class="hover:bg-white/[0.03] transition-all duration-300 group">
                            <td class="px-10 py-6 text-[10px] font-black text-red-500/60 uppercase tracking-widest">{{ i
                                + 1
                                }}</td>
                            <td class="px-10 py-6">
                                <div class="flex items-center gap-4">
                                    <div
                                        class="w-10 h-10 rounded-xl bg-red-600/10 flex items-center justify-center text-red-500 font-mono text-[10px] font-black border border-red-600/20">
                                        {{ (i + 1).toString().padStart(2, '0') }}
                                    </div>
                                    <span
                                        class="text-sm font-black text-white uppercase tracking-tight group-hover:text-red-500 transition-colors">{{
                                        area.nombre }}</span>
                                </div>
                            </td>
                            <td class="px-10 py-6 text-center">
                                <div
                                    class="inline-flex items-center gap-2 px-4 py-2 bg-white/5 rounded-full border border-white/10">
                                    <i class="fas fa-map-marker-alt text-[10px] text-red-500"></i>
                                    <span class="text-[10px] font-black text-white/60 uppercase tracking-widest">{{
                                        getUbicacionNombre(area.ubicacion_id) }}</span>
                                </div>
                            </td>
                            <td class="px-10 py-6 text-center">
                                <span [class]="area.estado === 'ACTIVO' ? 'badge-emerald' : 'badge-red'"
                                    class="font-black text-[9px] tracking-[0.2em]">
                                    {{ area.estado }}
                                </span>
                            </td>
                            <td class="px-10 py-6 text-right">
                                <div class="flex items-center justify-end gap-2">
                                    <button (click)="startEditArea(area)"
                                        class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 text-white/40 hover:bg-white/10 hover:text-white transition-all active:scale-90 border border-white/10">
                                        <i class="fas fa-edit text-xs"></i>
                                    </button>
                                    <button (click)="deleteArea(area.id)"
                                        class="w-10 h-10 flex items-center justify-center rounded-xl bg-red-600/10 text-red-500 hover:bg-red-600 hover:text-white transition-all active:scale-90 border border-red-600/20 shadow-lg shadow-red-600/5">
                                        <i class="fas fa-trash-alt text-xs"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Locations Section -->
    <div *ngIf="activeTab === 'ubicaciones'" class="animate-fade-in">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
            <h3 class="text-[10px] font-black text-red-500 uppercase tracking-[0.4em] flex items-center gap-3">
                <span class="w-8 h-[1px] bg-red-600"></span>
                Control de Instalaciones
            </h3>
            <button (click)="openForm('ubicacion')"
                class="btn-primary h-12 px-8 !shadow-red-600/30 text-[10px] font-black tracking-widest">
                <i class="fas fa-plus mr-2"></i> REGISTRAR SITIO
            </button>
        </div>

        <div class="bg-black/40 backdrop-blur-3xl border border-white/10 rounded-[2.5rem] overflow-hidden shadow-2xl">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr
                            class="bg-black/40 text-white/40 text-[9px] font-black uppercase tracking-[0.3em] border-b border-white/5">
                            <th class="px-10 py-6 w-20">Índice</th>
                            <th class="px-10 py-6">Instalación / Sitio</th>
                            <th class="px-10 py-6">Referencia Geográfica</th>
                            <th class="px-10 py-6 text-center">Disponibilidad</th>
                            <th class="px-10 py-6 text-right">Operaciones</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-white/5 font-medium">
                        <tr *ngFor="let ubi of filteredUbicaciones; let i = index"
                            class="hover:bg-white/[0.03] transition-all duration-300 group">
                            <td class="px-10 py-6 text-[10px] font-black text-red-500/60 uppercase tracking-widest">{{ i
                                + 1
                                }}</td>
                            <td class="px-10 py-6">
                                <div class="flex items-center gap-4">
                                    <div
                                        class="w-10 h-10 rounded-xl bg-red-600/10 flex items-center justify-center text-red-500 font-mono text-[10px] font-black border border-red-600/20">
                                        {{ (i + 1).toString().padStart(2, '0') }}
                                    </div>
                                    <span
                                        class="text-sm font-black text-white uppercase tracking-tight group-hover:text-red-500 transition-colors">{{
                                        ubi.nombre }}</span>
                                </div>
                            </td>
                            <td class="px-10 py-6">
                                <span
                                    class="text-[10px] font-black text-white/40 uppercase tracking-widest truncate block max-w-[250px]">{{
                                    ubi.direccion || 'SIN REFERENCIA' }}</span>
                            </td>
                            <td class="px-10 py-6 text-center">
                                <span [class]="ubi.estado === 'ACTIVO' ? 'badge-emerald' : 'badge-red'"
                                    class="font-black text-[9px] tracking-[0.2em]">
                                    {{ ubi.estado }}
                                </span>
                            </td>
                            <td class="px-10 py-6 text-right">
                                <div class="flex items-center justify-end gap-2">
                                    <button (click)="startEditUbicacion(ubi)"
                                        class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/5 text-white/40 hover:bg-white/10 hover:text-white transition-all active:scale-90 border border-white/10">
                                        <i class="fas fa-edit text-xs"></i>
                                    </button>
                                    <button (click)="deleteUbicacion(ubi.id)"
                                        class="w-10 h-10 flex items-center justify-center rounded-xl bg-red-600/10 text-red-500 hover:bg-red-600 hover:text-white transition-all active:scale-90 border border-red-600/20 shadow-lg shadow-red-600/5">
                                        <i class="fas fa-trash-alt text-xs"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>